{"version":3,"sources":["public/js/index.js"],"names":[],"mappings":"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","file":"public/js/index.js","sourcesContent":["class Graph {\n  constructor() {\n    this.database = new Firebase('https://kickstarter.firebaseio.com');\n    this.projectTitle = '';\n  }\n  \n  init() {\n    this._getData();\n    this._render();\n    this._events();\n  }\n  \n  _render() {\n    this._buildGraph();\n  }\n  \n  _events() {}\n\n  _getData() {\n    var proxyURL = 'https://jsonp.afeld.me/?url=';\n    var kickstarterURL = $('body').data('kickstarter');\n    var pseudoApi = 'https://www.kickstarter.com/projects/search.json?search=&term=';\n    var url = proxyURL + encodeURIComponent(kickstarterURL);\n\n    // ugh, this is terrible. get the title from the url, then search for the \n    // title to get some metadata \n    $.getJSON(url, d => {\n      this.title = $(d.card).find('.project-title').text();\n      \n      $('.title').text(this.title);\n    })\n\n    // get meta data\n    .then(()=> {\n      var url = proxyURL + encodeURIComponent(pseudoApi + this.title);\n      $.getJSON(url, d => {\n        window.console.log(d.projects);\n        this.metadata = d.projects[0];\n      });\n    });\n  }\n  \n  _buildGraph() {\n    \n    // grab all the points available once on load\n    this.database.limitToLast(24).once('value', event => {  \n      var w = $(window).width();\n      var h = $(window).height(); \n      var data = [];\n      var newItems = false;\n      var recentKey = 0;\n      var x, y, empty, area, graph, pct, money;\n      \n      function commaSeparateNumber(val){\n        while (/(\\d+)(\\d{3})/.test(val.toString())){\n          val = val.toString().replace(/(\\d+)(\\d{3})/, '$1'+','+'$2');\n        }\n        return val;\n      }\n\n      // add any new points that come in after load\n      this.database.on('value', event => { \n        var newData = [];\n\n        if (!newItems) {\n          newItems = true;\n          return;\n        }\n\n        _.each(event.val(), dataPiece => {\n          newData.push(parseInt(dataPiece.pledged, 10));\n        });\n\n        x = d3.scale.linear()\n          .domain([0, newData.length - 1])\n          .range([0, w]);\n\n        y = d3.scale.linear()\n          .domain([d3.min(newData), d3.max(newData)])\n          .range([h, 0]);\n\n        graph.selectAll('path')\n          .datum(newData)\n            .transition()\n            .duration(1000)\n            .attr('d', area); \n      });\n\n      for (var key in event.val()) {\n        if (event.val().hasOwnProperty(key)) {\n          let timestamp = event.val()[key];\n\n          // the keys are unix timestamps so the largest will be the \n          // most recent\n          recentKey = key > recentKey ? key : recentKey;\n\n          // push the pledged amounts into array for graph\n          data.push(parseInt(timestamp.pledged, 10)); \n        }\n      }\n\n      // current completion percent - value is given in decimal form\n      pct = parseInt(event.val()[recentKey].percentRaised * 100, 10);\n      money = event.val()[recentKey].pledged;\n\n      x = d3.scale.linear()\n        .domain([0, data.length - 1])\n        .range([0, w]);\n\n      y = d3.scale.linear()\n        .domain([d3.min(data), d3.max(data)])\n        .range([h, 0]);\n\n      // start all points at 0 so graph animates in\n      empty = d3.svg.area().interpolate('basis')\n        .x((d, i) => { return x(i); })\n        .y0(h)\n        .y1(()=> { return h; });\n\n      area = d3.svg.area().interpolate('basis')\n        .x((d, i) => { return x(i); })\n        .y0(h)\n        .y1(d => { return y(d); });\n\n      graph = d3.select('.graph').append('svg')\n        .attr('width', w)\n        .attr('height', h);\n\n      graph.append('path')\n        .datum(data)\n          .attr('d', empty)\n          .transition()\n          .duration(1000)\n          .attr('d', area);\n\n      $('.pct-complete').each(function() {\n        $(this)\n          .prop('counter', 0)\n          .animate({\n            counter: pct\n          }, {\n            duration: 1000,\n            easing: 'swing',\n            step: now => {\n              $(this).text(parseInt(now, 10) + '%');\n            }\n        });\n      });\n\n      $('.money-raised').each(function() {\n        $(this)\n          .prop('counter', 0)\n          .animate({\n            counter: money\n          }, {\n            duration: 1000,\n            easing: 'swing',\n            step: now => {\n              $(this).text('$' + commaSeparateNumber(now.toFixed(0)));\n            }\n        });\n      });\n    });    \n  }\n}\n\nclass KickstarterTracker {\n  constructor() {}\n  \n  init() {\n    this._render();\n    this._events();\n  }\n  \n  _render() {\n    new Graph().init();\n  }\n  \n  _events() {}\n}\nnew KickstarterTracker().init();"]}